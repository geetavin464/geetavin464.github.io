---
layout: post
title:  "Nginx"
date:   2015-03-02 20:38:32
categories: devops
description: Philosophy of nginx web server, configuration, commands and operation
---

* __Primer__
  * Nginx primarily deals with static files
  * Hands off other requests to another process
  * It does not have to know about Ruby or Python to handle a web request
  * It dispatches dynamic requests to another process (usually unicorn) and returns the results

* __Capabilities__
  * Open Source, Reverse Proxy, http cache, web server, Load balancer, serving static files

* __Nginx Commands__
  * `service nginx status`
  * `sudo service nginx start`
  * `sudo service nginx stop`
  * `sudo nginx -t` - Testing nginx configuration

* __How it works__
  * Master & Worker Processes
  * Master - read, evaluate and maintain worker processes
  * workers - actual processing of requests

* __Configuration__
  * `/etc/nginx/nginx.conf` - Top level config file. Includes other files listed below
  * `/etc/nginx/conf.d` folder
  * `/etc/nginx/sites-available`
  * `/etc/nginx/sites-enabled`

* __Static File Hosting Configuration__
  * 

* __Reverse Proxy Hosting Configuration__
  * Takes requests and sends those to another service
  * Typically the service is not publicly available
  * 

* __Upstream__
  * Defines server groups
  * When it contains more than 1 server - indicates load balancing

* __Resources__
  * [Excellent Article](https://serversforhackers.com/getting-started-with-nginx)

* __Server Block__
  * Main Directives: `listen` & `server_name`

* __listen__
  * Listens to ip address & port combinations
  * Unix sockets

* __Location Block__
  * Location block lives within a server block
  ```
  location optional_modifier location_match {

  }
  ```
* __location match__
  * none - prefix match
  * `=` - exact match
  * `~` - case-sensitive regular expression match
  * `~*` - case-insensitive regular expression match
  * `^~`-  best non regular expression match ( prefix or exact)

* __Directives__
  * `proxy_pass` - Sets the protocol and address of a proxied server
  * `proxy_redirect` - 

* __Installation on Ubuntu__
  * `sudo apt-get install nginx`

* __Deploy on Docker Container__
  * `docker pull nginx` - official nginx image
  * `docker run --name docker-nginx -p 80:80 nginx`
  * Symlink host filesystem to docker filesystem
  * `docker run --name docker-nginx -p 80:80 -d -v ~/docker-nginx/html:/user/share/nginx/html nginx`
  * `https://www.digitalocean.com/community/tutorials/how-to-run-nginx-in-a-docker-container-on-ubuntu-14-04`
  * `https://blog.docker.com/2015/04/tips-for-deploying-nginx-official-image-with-docker/`

* __Content Files__
  * Default Location for content files `/usr/share/nginx/html`
  * Default location for configuration `/etc/nginx`
  * `:ro` - readonly in the container

* __Global Installation vs Container Installation__
  * 