---
layout: post
title:  "AWS"
date:   2015-03-02 07:24:32
categories: devops
description: Frequently used services in AWS, their purpose, features and differences
---

* __Basics__
  * AWS - Cloud provider
  * Most Used AWS Cloud Services - EC2, RDS, S3, Route 53

* __Best Practices__
  * Design for failure

* __VPC__
  * Old accounts have still use classic EC2
  * New accounts have a default VPC option

* __EC2__
  * Allows users to rent virtual machines(instance)
  * A user can create, launch and terminate instances 
  * Pay by the hour for active servers
  * Elastic - easy to change. adjust size & number

* __EC2 Instance Launch__
  * When you launch an isntance, configuration details
  * user_data
  * Specify commands that need to run after the instance is launched

* __EC2 Initial Server Setup__
  * 
* __Elastic IP__
  * EIP is not specific to a particular instance
  * You have associate it with an instance, until you chose to release
  * Elastic IP is a public IP. An account can only have upto 5 EIPs, because ipv4 addresses are a scarce commodity
  * EIPs are used to mask the failure of an instance by rapidly remapping to another instance
  * For all internal communication use endpoints or DNS hostnames
  * You can associate an EIP to and from instances until you chose to release it

* __ELB__
  * Multiple EC2 instances in different zones
  * Same CNAME
  * We need to define what healthy means
  * Healthcheck configuration

* __Volume Storage__
  * EBS - Persistent storage. ( Retains even after instance is terminated)
  * Local/Ephemeral Volums - not persistent
  * You create EBS separately and attach to EC2 instances
  * Create a file system or run a database on these storage devices
  * 2 types - Standard, Provisioned IOPS for consistent performance
  * Volumes upto 1TB in size
  * Multiple volumes to a single instance
  * Specify I/O performance
  * Format with a filesystem
  * Create snapshots & have them persist in S3
  * Use these snapshots to instantiate new volumes
  * Snapshot can be taken, while in use. However it takes only completed writes
  * Unmount - snapshot - remount ( to pause writes)
  * Snapshots incrementally
  * Keep your persistent data independent from your EC2 instances

* __Elastic Beanstalk__
  * Workflow:
  * Create your application
  * Create Elastic beanstalk environment
  * Behind the scenes elastic beanstalk, takes care of EC2 & load balancers
  * Commit & publish to beanstalk via git
  * Within a few minutes you are able to access your application at a customized url
  * Default elastic beanstalk environment uses single micro instance
  * By default it uses, Amazon Linux or Windows 2008 server
  * Runs ELB
  * Provides a URL
  * You can configure High avafilability
  * Multi AZ
  * No additional cost for elastic beanstalk
  * Only pay for AWS resources used

* __Billing Criteria__
  * Instance Class, Running Time, IOPS, Storage, Backup Storage & Retention Period, Data Transfer

* __IAM - Identity & Access Management__
  * Create an account with root/master account
  * Best practice - Do not use this account
  * Create another admin account
  * Create user. Generate access key.
  * By default, this user has no permissions and no privileges
  * For permissions, we can chose a policy template for create a custom policy
  * You can use MFA Multi Factor Authentication to login
  * All accounts have root credentials, which allows full access. You cannot control the privileges. Use IAM user accounts instead, which can be modified and deleted. 
  * Root account credentials are the email_address and password that you used when you first registed at AWS

* __Keypairs__
  * Public Key cryptography to encrypt & decrypt log info
  * Used to login using ssh
  * Naming Convention: 
  * When you create a keypair, it downloads a pem file for it automatically
  * `.pem` is the private key in the public/private key pair
  * `chmod 0400 ~/dev-2014.pem` - Make it read only so the ssh client does not complain
  * The .pem file is your private key
  * 

* __Independent Scalability__
  * When you buy a server, you get CPU, Memory, Storage, IOPS bundled together, which can be scaled independently

* __RDS__
  * No ssh access to RDS instances
  * You can only access the mysql server
  * Manages backups, software patching, automatic failure detection, recovery from the synchronous secondary instance
  * You can also create snapshots for restoration purposes

* __Multi AZ deployment__
  * This option provides failover support
  * Maintains a synchronous secondary instance/replica

* __CloudWatch__
  * To monitor the performance and health of the instances

* __Monitoring Best Practices__
  * Make it a priority
  * Be able to easily debug multi point failures
  * What are your goals for monitoring?
  * What resources do we monitor?
  * Who should be notified when something goes wrong?
  * Establish a baseline based on historic data
  * As you detect anamolies, devise methods to address them

* __Monitoring Metrics__
  * CPU Utilization
  * Disk IO
  * Network Utilization

* __EC2 Status Checks__
  * System Status Checks
  * Instance Status Checks

* __Access to an instance__
  * You lose access, if you lose the private key

* __Security Groups__
  * Controls inbound & outbound traffic
  * Default security group - allows no access
  * You can speficy security groups for EC2, RDS, VPC etc
  * A security group has rules
  * A rule is an IP address range
  * A group can have upto 20 rules
  * Traffic Type/Protocol - ssh, http, tcp etc
  * Port Range 
  * Source - IP address, other security groups
  * Source is specified in CIDR notation - Classless Internet Domain Routing notation
  * `0.0.0.0/32` - most restrictive. No access
  * `0.0.0.0/0` - least restrictive. Complete access
  * Suffix `/8` - first octet must match
  * Suffix `/16` - first two octets must match
  * Suffix `/24` - first three octets must match
  * Suffix `/32` - all four octets must match
  * Create 2 security groups, 1 for ELB, other for web tier
  * ELB - Allow http traffic on port 80 from anywhere
  * web-tier - Allow http traffic on port 80 only from elb. You can specify the elb security group id in the source

* __Route 53__
  * DNS Service
  * Provides secure reliable routing to instances
  * Update name servers & record sets for hosted zones
  * Maintains hosted zones which is a collection of resource record sets
  * DNS takes time to propagate

* __Update an Ubuntu EC2 instance__
  * Create an AMI(full carbon copy) of the existing server
  * `sudo do-release-upgrade`
  * If anything fails launch the newly created AMI and reassociate the elastic IP

* __EBS__
  * EBS provides persistent storage
  * EBS has volumes. 
  * Volumes are like virtual hard drives. They can be attached to or detached from instances
  * A volume can only be attached to 1 instance at a time
  * Volumes can have snapshots and can be restored to a particular snapshot

* __EBS backed instance__
  * When the instance loads up, it loads the root file system onto a new EBS volume
  * Layering of the EC2 virtual machine technology over EBS virtual hard drive technology
  * The instance is a volume itself

* __Virtual Machine__
  * Emulation of a computer system

* __AMI__
  * Used to instantiate a virtual machine within EC2

* __RDS__
  * Cloudwatch service
  * Subscribe to RDS events
  * database log files RDS console
  * query database log files
  * Monitor the error log, slow query log, general log
  * What is log rotation?
  * RDS Log Files are removed after 24 hours

* __Snapshots & Restoration__
  * AMI: An EBS volume that contains an OS, file system, kernel, applications & everything to boot up
  *  EBS: is like a hard disk drive volume. Rent many EBS volums, add files and mount on your instance
  * Instance: Complete virtual machine. Everytime you launch an AMI, you get to chose its virtual hardware. 
  * Root Device: EBS volume used to boot up the instance
  * Snapshot: Copy of your EBS volume. Virtual hard disk. You take a snapshot. Amazon converts it into AMI

* __Things to note__
  * To make sure the new instance is not in the same zone as the existing zone, make a note of the following 
  * Availability Zone
  * Security Group

* __Backup__
  * Create Image
  * Enter name & description for your use
  * EC2 machine is switched off. 
  * EBS volume is copied to a snapshot
  * EC2 is switched on again
  * How is snapshot different from AMI ?

* __Launch__
  * Select the AMI & click launch
  * Chose AZ, keypairs, 
  * 20 Gig, Magnetic?
  * Add security group. 4 29. 

* __Practice__
  * Systems Architecture
  * System in US East Region
  * Web Severs in separate availability zones
  * RDS
  * Anyone in the public internet can hit the ELB on port 80
  * Only the ELB & an admin can hit the web servers on port 80
  * Only web servers can connect to RDS
